/*! Copyright 2015-2025 zhangfuxiang 支付卡新兴事业部. */!function($){$.fn.treeTable=function(opts){function hoverActiveNode(event){var $target=$(event.target);if($target.attr("controller")&&($target=$target.parents("tr[haschild]").find("[arrow]")),$target.attr("arrow")){var className=$target.attr("class");if(className&&!className.indexOf(css.AN)){var len=opts.theme.length+1;return className=className.split(" ")[1].substr(len),className=0===className.indexOf("hover_")?opts.theme+"_"+className.substr(6):opts.theme+"_hover_"+className,void $target.attr("class",css.AN+" "+className)}}}function initRelation($trs,hideLevel){function getDepth(id){if(0==cMap[id])return 1;var $parentDepth=getDepth(cMap[id]);return $parentDepth+1}$trs.each(function(i){var pId=$(this).attr("pId")||0;pMap[pId]||(pMap[pId]=[]),pMap[pId].push(this.id),cMap[this.id]=pId,$(this).addClass(pId)}).find("[controller]").css("cursor","pointer"),$trs.each(function(i){if(this.id){var $tr=$(this);pMap[this.id]&&$tr.attr("hasChild",!0);var pArr=pMap[cMap[this.id]];if(pArr[0]==this.id)$tr.attr("isFirstOne",!0);else{for(var prevId=0,i=0;i<pArr.length&&pArr[i]!=this.id;i++)prevId=pArr[i];$tr.attr("prevId",prevId)}pArr[pArr.length-1]==this.id&&$tr.attr("isLastOne",!0);var depth=getDepth(this.id);if($tr.attr("depth",depth),formatNode(this),hideLevel&&(depth>opts.expandLevel&&$tr.hide(),$tr.attr("hasChild")&&$tr.attr("depth")<opts.expandLevel)){var className=$tr.attr("isLastOne")?css.LO:css.O;$tr.find("."+css.AN).attr("class",css.AN+" "+className)}}})}function shut(id){if(!pMap[id])return!1;for(var i=0;i<pMap[id].length;i++)shut(pMap[id][i]);$("tr."+id,$treeTable).hide()}function open(id){if($("tr."+id,$treeTable).show(),!pMap[id])return!1;for(var i=0;i<pMap[id].length;i++){var cId=pMap[id][i];if(pMap[cId]){var className=$("#"+cId,$treeTable).find("."+css.AN).attr("class");(className==css.AN+" "+css.O||className==css.AN+" "+css.LO)&&open(cId)}}}function formatNode(tr){var $cur=$(tr),id=tr.id;if(0==cMap[id])var $preSpan=$('<span class="prev_sp"></span>');else if($cur.attr("isFirstOne")){var $parent=$("#"+cMap[id],$treeTable),$preSpan=$parent.children("td").eq(opts.column).find(".prev_sp").clone();$parent.attr("isLastOne")?$preSpan.append('<span class="'+css.N+" "+css.B+'"></span>'):$preSpan.append('<span class="'+css.N+" "+css.V+'"></span>')}else var $preSpan=$("#"+$cur.attr("prevId"),$treeTable).children("td").eq(opts.column).find(".prev_sp").clone();if($cur.attr("hasChild")){var className=$cur.attr("isLastOne")?css.LS:css.S;className=css.AN+" "+className}else var className=css.N+" "+($cur.attr("isLastOne")?css.LL:css.L);var $td=$cur.children("td").eq(opts.column);$td.prepend('<span arrow="true" class="'+className+'"></span>').prepend($preSpan)}opts=$.extend({path:"",theme:"default",expandLevel:1,column:0,onSelect:function($treeTable,id){},beforeExpand:function($treeTable,id){}},opts);var $treeTable=this;$treeTable.addClass("tree_table");var css={N:opts.theme+"_node",AN:opts.theme+"_active_node",O:opts.theme+"_open",LO:opts.theme+"_last_open",S:opts.theme+"_shut",LS:opts.theme+"_last_shut",HO:opts.theme+"_hover_open",HS:opts.theme+"_hover_shut",HLO:opts.theme+"_hover_last_open",HLS:opts.theme+"_hover_last_shut",L:opts.theme+"_leaf",LL:opts.theme+"_last_leaf",B:opts.theme+"_blank",V:opts.theme+"_vertline"},pMap={},cMap={},$trs=$treeTable.find("tr");return initRelation($trs,!0),$treeTable.click(function(event){var $target=$(event.target);if($target.attr("controller")){if($target=$target.parents("tr[haschild]").find("[arrow]"),$target.attr("class").indexOf(css.AN)==-1&&$target.attr("class").indexOf(css.N)==-1)return;var id=$target.parents("tr[haschild]")[0].id;if(opts.onSelect&&opts.onSelect($treeTable,id)===!1)return}if($target.attr("arrow")){var className=$target.attr("class");if(className==css.AN+" "+css.HLO||className==css.AN+" "+css.HO){var id=$target.parents("tr[haschild]")[0].id;return $target.attr("class",css.AN+" "+(className.indexOf(css.HO)!=-1?css.HS:css.HLS)),void shut(id)}if(className==css.AN+" "+css.HLS||className==css.AN+" "+css.HS){var id=$target.parents("tr")[0].id;return $target.attr("class",css.AN+" "+(className.indexOf(css.HS)!=-1?css.HO:css.HLO)),opts.beforeExpand($treeTable,id),void open(id)}}}),$treeTable.mouseover(hoverActiveNode).mouseout(hoverActiveNode),$treeTable.addChilds=function(trsHtml){var $trs=$(trsHtml);if(!$trs.length)return!1;var pId=$($trs[0]).attr("pId");if(!pId)return!1;var insertId=pMap[pId]&&pMap[pId][pMap[pId].length-1]||pId;$("#"+insertId,$treeTable).after($trs),initRelation($trs)},$treeTable}}(jQuery);
